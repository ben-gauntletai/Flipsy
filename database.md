# Flipsy Database Schema

## Collections

### users
Stores user profile information and authentication details.

**Document ID:** `{userId}` (Generated by Firebase Auth)
```typescript
{
  displayName: string;
  email: string;
  avatarURL?: string;
  bio?: string;
  createdAt: timestamp;
  updatedAt: timestamp;
  followersCount: number;
  followingCount: number;
  totalLikes: number;
  totalVideos: number;
}
```

### videos
Stores video metadata and references.

**Document ID:** `{videoId}` (Auto-generated)
```typescript
{
  userId: string;          // Reference to users/{userId}
  videoURL: string;        // Cloud Storage URL
  thumbnailURL: string;    // Cloud Storage URL
  description?: string;
  createdAt: timestamp;
  updatedAt: timestamp;
  likesCount: number;
  commentsCount: number;
  shareCount: number;
  duration: number;        // Video duration in seconds
  width: number;          // Video width in pixels
  height: number;         // Video height in pixels
  status: 'processing' | 'active' | 'deleted';
  aiEnhancements?: {
    captions?: string;    // Generated captions
    tags?: string[];      // AI-generated tags
    category?: string;    // AI-categorized content type
  }
}
```

### likes
Subcollection of videos to track user likes.

**Path:** `videos/{videoId}/likes/{userId}`
```typescript
{
  userId: string;         // Reference to users/{userId}
  createdAt: timestamp;
}
```

### comments
Subcollection of videos to store user comments.

**Path:** `videos/{videoId}/comments/{commentId}`
```typescript
{
  userId: string;         // Reference to users/{userId}
  text: string;
  createdAt: timestamp;
  updatedAt: timestamp;
  likesCount: number;
}
```

### follows
Tracks user follow relationships.

**Document ID:** `{followerId}_{followingId}`
```typescript
{
  followerId: string;     // User who is following
  followingId: string;    // User being followed
  createdAt: timestamp;
}
```

### notifications
Stores user notifications.

**Document ID:** Auto-generated
```typescript
{
  userId: string;         // Recipient user
  type: 'like' | 'comment' | 'follow';
  sourceUserId: string;   // User who triggered the notification
  videoId?: string;      // Referenced video if applicable
  commentId?: string;    // Referenced comment if applicable
  createdAt: timestamp;
  read: boolean;
}
```

## Security Rules

Basic security rules will ensure:
1. Users can only read/write their own profile data
2. Videos are publicly readable but only writable by their owners
3. Likes and comments are publicly readable but only writable by authenticated users
4. Notifications are only readable/writable by the recipient user

## Indexes

Required indexes will be created for:
1. Videos by userId + createdAt (for profile pages)
2. Videos by status + createdAt (for feed)
3. Comments by videoId + createdAt
4. Notifications by userId + read + createdAt

## Notes

- All timestamp fields use Firestore's native timestamp type
- Counters (likesCount, followersCount, etc.) use atomic operations
- Soft deletion is implemented using the status field where applicable
- AI enhancements are stored as nested objects for flexibility



